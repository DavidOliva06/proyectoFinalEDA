<div class="simulator-page">
  <div class="simulator-container">
    <div class="controls-section">
      <app-controls
        [isSessionActive]="!!activeTree()"
        (createTree)="handleCreateTree($event)"
        (operation)="handleOperation($event)">
      </app-controls>
    </div>

    <div class="visualization-section">
      <div class="feedback-panel">
        <div *ngIf="isLoading()" class="loading-indicator">Cargando...</div>
        <div *ngIf="message() && !isLoading()" class="message-display">{{ message() }}</div>
      </div>
      
      <!-- 
        --- CORRECCIÓN PRINCIPAL AQUÍ ---
        1. Usamos un `ng-container` para aplicar la directiva *ngIf.
        2. `*ngIf="activeTree() as tree"` hace lo siguiente:
           - Evalúa `activeTree()`. Si el resultado es 'truthy' (no es null, undefined, false, 0, etc.), el bloque se renderiza.
           - Crea una nueva variable local llamada `tree` que contiene el valor de `activeTree()`.
           - El compilador de Angular es lo suficientemente inteligente como para saber que DENTRO de este bloque, la variable `tree` NUNCA será null.
      -->
      <ng-container *ngIf="activeTree() as tree; else noTreeTemplate">
        <!-- 3. Ahora, pasamos la nueva variable 'tree' (que sabemos que no es null) al input del componente hijo. -->
        <app-visualization [tree]="tree"></app-visualization>
      </ng-container>

      <!-- El `else` sigue funcionando de la misma manera -->
      <ng-template #noTreeTemplate>
        <div class="placeholder-visualization">
          <div class="placeholder-content">
            <h2>Bienvenido al Simulador</h2>
            <p>Para empezar, crea un nuevo árbol en el panel de la izquierda o carga uno desde tu dashboard.</p>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>