<div class="simulator-page">
  <div class="simulator-container">
    <div class="controls-section">
      <!-- El componente de controles recibe el estado booleano de si hay una sesión activa -->
      <app-controls
        [isSessionActive]="!!activeTree()"
        (createTree)="handleCreateTree($event)"
        (operation)="handleOperation($event)">
      </app-controls>
    </div>

    <div class="visualization-section">
      <div class="feedback-panel">
        <!-- Mostramos un indicador de carga mientras se procesa una petición -->
        <div *ngIf="isLoading()" class="loading-indicator">Cargando...</div>
        <!-- Mostramos mensajes de estado cuando no está cargando -->
        <div *ngIf="message() && !isLoading()" class="message-display">{{ message() }}</div>
      </div>
      
      <!-- 
        --- CORRECCIÓN PRINCIPAL AQUÍ ---
        La directiva *ngIf ahora está en el propio componente app-visualization.
        Esto garantiza que el componente solo se renderizará cuando 'activeTree()' NO sea null,
        satisfaciendo así la condición del input que requiere un objeto 'Tree' y no 'null'.
      -->
      <app-visualization 
        *ngIf="activeTree(); else noTreeTemplate" 
        [tree]="activeTree()">
      </app-visualization>

      <!-- 
        El 'else' del *ngIf apunta a esta plantilla, que se muestra cuando 'activeTree()' es null.
      -->
      <ng-template #noTreeTemplate>
        <div class="placeholder-visualization">
          <div class="placeholder-content">
            <h2>Bienvenido al Simulador</h2>
            <p>Para empezar, crea un nuevo árbol en el panel de la izquierda o carga uno desde tu dashboard.</p>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>